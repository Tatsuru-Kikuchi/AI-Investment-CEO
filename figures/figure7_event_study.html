<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figure 7: Event Study - Dynamic Treatment Effects of AI Adoption</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 20px;
            background-color: #ffffff;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .subtitle {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .chart-container {
            margin: 20px 0;
        }
        
        .axis-label {
            font-size: 12px;
            font-weight: bold;
        }
        
        .grid-line {
            stroke: #e0e0e0;
            stroke-width: 0.5;
            stroke-dasharray: 2,2;
        }
        
        .zero-line {
            stroke: #999;
            stroke-width: 1;
        }
        
        .treatment-line {
            stroke: #e74c3c;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }
        
        .confidence-band {
            fill: #3498db;
            opacity: 0.2;
        }
        
        .effect-line {
            fill: none;
            stroke: #2980b9;
            stroke-width: 3;
        }
        
        .effect-points {
            fill: #2980b9;
            stroke: white;
            stroke-width: 2;
        }
        
        .pre-treatment-points {
            fill: #95a5a6;
            stroke: white;
            stroke-width: 2;
        }
        
        .post-treatment-points {
            fill: #e67e22;
            stroke: white;
            stroke-width: 2;
        }
        
        .legend {
            font-size: 11px;
        }
        
        .notes {
            font-size: 10px;
            color: #666;
            margin-top: 20px;
            line-height: 1.4;
        }
        
        .stats-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-size: 11px;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Figure 7: Event Study - Dynamic Treatment Effects of AI Adoption</div>
        <div class="subtitle">Quarterly Productivity Growth Relative to Control Group</div>
        
        <div class="chart-container">
            <svg id="eventStudy" width="900" height="500"></svg>
        </div>
        
        <div class="stats-box">
            <div class="stats-row">
                <span><strong>Sample:</strong> 542 firms, 6,504 firm-quarter observations</span>
                <span><strong>Method:</strong> Event study with firm and time fixed effects</span>
            </div>
            <div class="stats-row">
                <span><strong>Pre-treatment trend test:</strong> F-statistic = 1.23 (p = 0.307)</span>
                <span><strong>Peak effect:</strong> <span class="highlight">2.8% at quarter +2</span></span>
            </div>
            <div class="stats-row">
                <span><strong>Long-run effect:</strong> <span class="highlight">2.4% (quarters +4 to +6)</span></span>
                <span><strong>Parallel trends:</strong> Supported (pre-treatment coefficients near zero)</span>
            </div>
        </div>
        
        <div class="notes">
            <strong>Notes:</strong> This figure shows the dynamic treatment effects of AI adoption using event study methodology. 
            Effects are measured as quarterly productivity growth relative to control group. The vertical red line indicates 
            AI implementation (quarter 0). Pre-treatment effects are near zero, supporting parallel trends assumption. 
            Peak effect of 2.8% occurs at quarter 2, with long-run effect stabilizing at 2.4%. 95% confidence intervals 
            shown in blue shading. Sample includes firms that adopted AI between 2019-2022, with at least 4 quarters of 
            pre-treatment data and 6 quarters of post-treatment follow-up.
        </div>
    </div>

    <script>
        // Event study data: quarters relative to AI adoption and treatment effects
        const eventData = [
            { quarter: -4, effect: -0.2, se: 0.8, significant: false },
            { quarter: -3, effect: 0.1, se: 0.7, significant: false },
            { quarter: -2, effect: -0.3, se: 0.6, significant: false },
            { quarter: -1, effect: 0.0, se: 0.5, significant: false },
            { quarter: 0, effect: 1.2, se: 0.4, significant: true },
            { quarter: 1, effect: 2.1, se: 0.5, significant: true },
            { quarter: 2, effect: 2.8, se: 0.6, significant: true },
            { quarter: 3, effect: 2.6, se: 0.6, significant: true },
            { quarter: 4, effect: 2.4, se: 0.7, significant: true },
            { quarter: 5, effect: 2.3, se: 0.8, significant: true },
            { quarter: 6, effect: 2.4, se: 0.9, significant: true }
        ];

        // Calculate confidence intervals
        eventData.forEach(d => {
            d.ci_lower = d.effect - 1.96 * d.se;
            d.ci_upper = d.effect + 1.96 * d.se;
        });

        // Set up dimensions and margins
        const margin = {top: 40, right: 80, bottom: 80, left: 80};
        const width = 900 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        const svg = d3.select("#eventStudy")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Set up scales
        const xScale = d3.scaleLinear()
            .domain([-4, 6])
            .range([0, width]);

        const yScale = d3.scaleLinear()
            .domain([-2, 4])
            .range([height, 0]);

        // Add grid lines
        const xAxis = d3.axisBottom(xScale)
            .tickSize(-height)
            .tickFormat("");

        const yAxis = d3.axisLeft(yScale)
            .tickSize(-width)
            .tickFormat("");

        g.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(0,${height})`)
            .call(xAxis)
            .selectAll("line")
            .attr("class", "grid-line");

        g.append("g")
            .attr("class", "grid")
            .call(yAxis)
            .selectAll("line")
            .attr("class", "grid-line");

        // Add zero line
        g.append("line")
            .attr("class", "zero-line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", yScale(0))
            .attr("y2", yScale(0));

        // Add treatment line at quarter 0
        g.append("line")
            .attr("class", "treatment-line")
            .attr("x1", xScale(0))
            .attr("x2", xScale(0))
            .attr("y1", 0)
            .attr("y2", height);

        // Add confidence band
        const area = d3.area()
            .x(d => xScale(d.quarter))
            .y0(d => yScale(d.ci_lower))
            .y1(d => yScale(d.ci_upper))
            .curve(d3.curveMonotoneX);

        g.append("path")
            .datum(eventData)
            .attr("class", "confidence-band")
            .attr("d", area);

        // Add effect line
        const line = d3.line()
            .x(d => xScale(d.quarter))
            .y(d => yScale(d.effect))
            .curve(d3.curveMonotoneX);

        g.append("path")
            .datum(eventData)
            .attr("class", "effect-line")
            .attr("d", line);

        // Add effect points
        g.selectAll(".effect-point")
            .data(eventData)
            .enter().append("circle")
            .attr("class", d => d.quarter < 0 ? "pre-treatment-points" : 
                               d.quarter === 0 ? "effect-points" : "post-treatment-points")
            .attr("cx", d => xScale(d.quarter))
            .attr("cy", d => yScale(d.effect))
            .attr("r", d => d.significant ? 5 : 4)
            .style("opacity", d => d.significant ? 1 : 0.7);

        // Add axes
        g.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale)
                .tickValues([-4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6])
                .tickFormat(d => d === 0 ? "AI Adoption" : (d > 0 ? `+${d}` : `${d}`)))
            .selectAll("text")
            .style("font-size", "11px");

        g.append("g")
            .call(d3.axisLeft(yScale)
                .tickFormat(d => `${d}%`))
            .selectAll("text")
            .style("font-size", "11px");

        // Add axis labels
        g.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left + 20)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Productivity Effect (%)");

        g.append("text")
            .attr("class", "axis-label")
            .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 20})`)
            .style("text-anchor", "middle")
            .text("Quarters Relative to AI Adoption");

        // Add treatment line label
        g.append("text")
            .attr("x", xScale(0) + 5)
            .attr("y", 15)
            .style("fill", "#e74c3c")
            .style("font-size", "11px")
            .style("font-weight", "bold")
            .text("AI Implementation");

        // Add legend
        const legend = g.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width - 180}, 20)`);

        const legendItems = [
            { color: "#95a5a6", label: "Pre-treatment", type: "circle" },
            { color: "#2980b9", label: "Implementation", type: "circle" },
            { color: "#e67e22", label: "Post-treatment", type: "circle" },
            { color: "#3498db", label: "95% Confidence Interval", type: "band" }
        ];

        legendItems.forEach((item, i) => {
            const legendRow = legend.append("g")
                .attr("transform", `translate(0, ${i * 20})`);

            if (item.type === "circle") {
                legendRow.append("circle")
                    .attr("cx", 6)
                    .attr("cy", 0)
                    .attr("r", 4)
                    .style("fill", item.color)
                    .style("stroke", "white")
                    .style("stroke-width", 1);
            } else {
                legendRow.append("rect")
                    .attr("x", 2)
                    .attr("y", -4)
                    .attr("width", 8)
                    .attr("height", 8)
                    .style("fill", item.color)
                    .style("opacity", 0.2);
            }

            legendRow.append("text")
                .attr("x", 18)
                .attr("y", 0)
                .attr("dy", "0.35em")
                .style("font-size", "10px")
                .text(item.label);
        });

        // Add key statistics annotations
        g.append("text")
            .attr("x", xScale(2) + 10)
            .attr("y", yScale(2.8) - 5)
            .style("font-size", "10px")
            .style("font-weight", "bold")
            .style("fill", "#e67e22")
            .text("Peak: 2.8%");

        g.append("text")
            .attr("x", xScale(5) + 10)
            .attr("y", yScale(2.4) + 15)
            .style("font-size", "10px")
            .style("font-weight", "bold")
            .style("fill", "#e67e22")
            .text("Long-run: 2.4%");

        // Add arrows pointing to key effects
        g.append("line")
            .attr("x1", xScale(2) + 8)
            .attr("y1", yScale(2.8) - 2)
            .attr("x2", xScale(2) + 2)
            .attr("y2", yScale(2.8) + 3)
            .style("stroke", "#e67e22")
            .style("stroke-width", 1)
            .attr("marker-end", "url(#arrowhead)");

        // Define arrowhead marker
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 8)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .style("fill", "#e67e22");
    </script>
</body>
</html>